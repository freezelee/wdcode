/*
**  ComponentJS -- Component System for JavaScript <http://componentjs.com>
**  Copyright (c) 2009-2013 Ralf S. Engelschall <http://engelschall.com>
**	V0.9.8
**  This Source Code Form is subject to the terms of the Mozilla Public
**  License, v. 2.0. If a copy of the MPL was not distributed with this
**  file, You can obtain one at http://mozilla.org/MPL/2.0/.
*/

ComponentJS.plugin("debugger",function(a,l,k){a.jq=function(c,b){var d=[];if(1===arguments.length&&"string"!==typeof c)d.push(c);else{"undefined"===typeof b&&(b=k.document);try{d=b.querySelectorAll(c)}catch(f){d=k.document}d=a.concat([],d)}a.extend(d,a.jq_methods);return d};a.jq_methods={ready:function(a){for(var b=0;b<this.length;b++)(function(b){var f=this[b];setTimeout(function(){a.call(f)},250)})(b)},bind:function(a,b){for(var d=0;d<this.length;d++)"function"===typeof this[d].addEventListener?
this[d].addEventListener(a,b,!1):"function"===typeof this[d].attachEvent&&this[d].attachEvent("on"+a,b);return this},width:function(a){for(var b="undefined"!==typeof a?this:void 0,d=0;d<this.length;d++)"undefined"===typeof a?(b=this[d].offsetWidth,"undefined"===typeof b&&(b=this[d].innerWidth),"undefined"===typeof b&&(b=this[d].clientWidth)):this[d].style.width=a;return b},height:function(a){for(var b="undefined"!==typeof a?this:void 0,d=0;d<this.length;d++)"undefined"===typeof a?(b=this[d].offsetHeight,
"undefined"===typeof b&&(b=this[d].innerHeight),"undefined"===typeof b&&(b=this[d].clientHeight)):this[d].style.height=a;return b},css:function(c,b){for(var d="undefined"!==typeof b?this:void 0,f=c.replace(/-([a-z])/g,function(a,b){return b.toUpperCase()}),g=0;g<this.length;g++)"undefined"===typeof b?d=this[g].style[f]:a.isIE()?this[g].style.cssText=c+":"+b+";":this[g].style[f]=b;return d},attr:function(a,b){for(var d="undefined"!==typeof b?this:void 0,f=0;f<this.length;f++)"undefined"===typeof b?
d=this[f].getAttribute(a):this[f].setAttribute(a,b);return d},html:function(c){for(var b=0;b<this.length;b++)try{this[b].innerHTML=c}catch(d){var f=a.dbg.document.createElement("div");for(f.innerHTML="<div>"+c+"</div>";this[b].firstChild;)this[b].removeChild(this[b].firstChild);for(var g=0;g<f.firstChild.childNodes.length;g++)this[b].appendChild(f.firstChild.childNodes[g])}return this},scrollTop:function(a){for(var b=0;b<this.length;b++)this[b].scrollTop=a;return this},get:function(a){return this[a]}};
a.dbg_view_mask=function(c){a.jq("html head",a.dbg.document).html("<title>"+c+"</title>");a.jq("html body",a.dbg.document).html("<style type=\"text/css\">html, body {margin: 0px;padding: 0px;}.dbg {width: 100%;height: 100%;font-family: Helvetica, Arial, sans-serif;background-color: #e0e0e0;overflow: hidden;font-size: 9pt;}.dbg .header {width: 100%;height: 30px;background: #666666;background: -moz-linear-gradient(top,  #666666 0%, #333333 49%, #222222 51%, #000000 100%);background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#666666), color-stop(49%,#333333), color-stop(51%,#222222), color-stop(100%,#000000));background: -webkit-linear-gradient(top,  #666666 0%,#333333 49%,#222222 51%,#000000 100%);background: -o-linear-gradient(top,  #666666 0%,#333333 49%,#222222 51%,#000000 100%);background: -ms-linear-gradient(top,  #666666 0%,#333333 49%,#222222 51%,#000000 100%);background: linear-gradient(to bottom,  #666666 0%,#333333 49%,#222222 51%,#000000 100%);filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#666666', endColorstr='#000000',GradientType=0 );text-align: center;position: relative;}.dbg .header .text {position: relative;top: 6px;color: #ffffff;font-size: 12pt;font-weight: bold;}.dbg .viewer {position: relative;width: 100%;height: 50%;background: #d0d0d0;background: -moz-linear-gradient(top,  #d0d0d0 0%, #e8e8e8 50%, #d0d0d0 100%);background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#d0d0d0), color-stop(50%,#e8e8e8), color-stop(100%,#d0d0d0));background: -webkit-linear-gradient(top,  #d0d0d0 0%,#e8e8e8 50%,#d0d0d0 100%);background: -o-linear-gradient(top,  #d0d0d0 0%,#e8e8e8 50%,#d0d0d0 100%);background: -ms-linear-gradient(top,  #d0d0d0 0%,#e8e8e8 50%,#d0d0d0 100%);background: linear-gradient(to bottom,  #d0d0d0 0%,#e8e8e8 50%,#d0d0d0 100%);filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#d0d0d0', endColorstr='#d0d0d0',GradientType=0 );overflow: hidden;}.dbg .viewer canvas {position: absolute;top: 0px;left: 0px;}.dbg .status {width: 100%;height: 20px;background: #666666;background: -moz-linear-gradient(top,  #666666 0%, #333333 49%, #222222 51%, #000000 100%);background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#666666), color-stop(49%,#333333), color-stop(51%,#222222), color-stop(100%,#000000));background: -webkit-linear-gradient(top,  #666666 0%,#333333 49%,#222222 51%,#000000 100%);background: -o-linear-gradient(top,  #666666 0%,#333333 49%,#222222 51%,#000000 100%);background: -ms-linear-gradient(top,  #666666 0%,#333333 49%,#222222 51%,#000000 100%);background: linear-gradient(to bottom,  #666666 0%,#333333 49%,#222222 51%,#000000 100%);filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#666666', endColorstr='#000000',GradientType=0 );color: #f0f0f0;text-align: center;}.dbg .status .text {position: relative;top: 3px;color: #ffffff;font-size: 9pt;}.dbg .console {width: 100%;height: 50%;background-color: #ffffff;color: #000000;overflow: scroll;font-size: 9pt;}.dbg .console .text {width: 100%;height: auto;}.dbg .console .text .line {border-collapse: collapse;width: 100%;border-bottom: 1px solid #e0e0e0;font-size: 9pt;}.dbg .console .text .num {width: 40px;background-color: #f0f0f0;text-align: right;}.dbg .console .text .msg {padding-left: 10px;}.dbg .console .text .msg .prefix {color: #999999;}.dbg .console .text .msg .context {font-weight: bold;}.dbg .console .text .msg .path {color: #003399;}.dbg .console .text .msg .state {font-style: italic;}.dbg .console .text .msg .arrow {color: #999999;}.dbg .console .text .msg .method {font-family: monospace;}.dbg .grabber {position: absolute; cursor: move; width: 100%;height: 20px;background-color: transparent;opacity: 0.5;z-index: 100;}.dbg .infobox {position: absolute;top: 0px;left: 0px;width: 100%;background-color: #ffffff;color: #000000;z-index: 200;display: none;}.dbg .infobox table {border-collapse: collapse;width: 100%;}.dbg .infobox table tr td {border-bottom: 1px solid #e0e0e0;}.dbg .infobox table tr td {font-size: 11pt;}.dbg .infobox table tr td.label {padding-left: 10px;background-color: #f0f0f0;color: #909090;vertical-align: top;width: 160px;}.dbg .infobox table tr td.value {padding-left: 10px;vertical-align: top;}.dbg .infobox table tr td.value span.none {color: #909090;font-style: italic;}.dbg .plus, .dbg .reset, .dbg .minus {position: absolute; top: 4px; width: 10px; text-align: center; font-weight: bold; padding: 2px 8px 2px 8px; border-top: 1px solid #777777;border-left: 1px solid #777777;border-right: 1px solid #555555;border-bottom: 1px solid #555555;background: #666666;background: -moz-linear-gradient(top,  #666666 0%, #333333 49%, #222222 51%, #000000 100%);background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#666666), color-stop(49%,#333333), color-stop(51%,#222222), color-stop(100%,#000000));background: -webkit-linear-gradient(top,  #666666 0%,#333333 49%,#222222 51%,#000000 100%);background: -o-linear-gradient(top,  #666666 0%,#333333 49%,#222222 51%,#000000 100%);background: -ms-linear-gradient(top,  #666666 0%,#333333 49%,#222222 51%,#000000 100%);background: linear-gradient(to bottom,  #666666 0%,#333333 49%,#222222 51%,#000000 100%);filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#666666', endColorstr='#000000',GradientType=0 );color: #c0c0c0;z-index: 100;}.dbg .plus {right: 80px; }.dbg .reset {right: 110px; }.dbg .minus {right: 140px; }.dbg .exporter {position: absolute; top: 4px; right: 20px; padding: 2px 8px 2px 8px; border-top: 1px solid #777777;border-left: 1px solid #777777;border-right: 1px solid #555555;border-bottom: 1px solid #555555;background: #666666;background: -moz-linear-gradient(top,  #666666 0%, #333333 49%, #222222 51%, #000000 100%);background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#666666), color-stop(49%,#333333), color-stop(51%,#222222), color-stop(100%,#000000));background: -webkit-linear-gradient(top,  #666666 0%,#333333 49%,#222222 51%,#000000 100%);background: -o-linear-gradient(top,  #666666 0%,#333333 49%,#222222 51%,#000000 100%);background: -ms-linear-gradient(top,  #666666 0%,#333333 49%,#222222 51%,#000000 100%);background: linear-gradient(to bottom,  #666666 0%,#333333 49%,#222222 51%,#000000 100%);filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#666666', endColorstr='#000000',GradientType=0 );color: #c0c0c0;z-index: 100;}</style><div class=\"dbg\"><div class=\"header\"><div class=\"text\">"+
c+'</div></div><div class="viewer"><canvas></canvas></div><div class="grabber"></div><div class="plus">+</div><div class="reset">0</div><div class="minus">-</div><div class="exporter">Export</div><div class="status"><div class="text"></div></div><div class="console"><div class="text"></div></div><div class="infobox"></div></div>')};a.dbg_logline=0;a.dbg_logbook="";a.dbg_log=function(c){null!==a.dbg&&(c=c.replace("&","&amp;").replace("<","&lt;").replace(">","&gt;").replace("\n","<br/>"),a.dbg_logline++,
c=c.replace(/(DEBUG\[\d+\]: )([^:]+)/,'<span class="prefix">$1</span><span class="context">$2</span>'),c=c.replace(/(\s+)(\/[^:\s]*)/g,'$1<span class="path">$2</span>'),c=c.replace(/(\s+)(@[a-z]+)/g,'$1<span class="state">$2</span>'),c=c.replace(/((?:&lt;)?--\()([a-z]+)(\)--(?:&gt;)?)/g,'<span class="arrow">$1</span><span class="method">$2</span><span class="arrow">$3</span>'),a.dbg_logbook+='<table class="line"><tr><td class="num">'+a.dbg_logline+'.</td><td class="msg">'+c+"</td></tr></table>",a.dbg_state_invalidate("console"),
a.dbg_update())};a.dbg_infobox_content=function(c){var b,d,f,g="";b=c.name().replace(/</,"&lt;").replace(/>/,"&gt;");var g=g+('<tr><td class="label">Name:</td><td class="value"><b>'+b+"</b></td></tr>")+('<tr><td class="label">Path:</td><td class="value"><code>'+c.path("/")+"</code></td></tr>"),e="";l.marked(c.obj(),"view")&&(e+="view, ");l.marked(c.obj(),"model")&&(e+="model, ");l.marked(c.obj(),"controller")&&(e+="controller, ");l.marked(c.obj(),"service")&&(e+="service, ");e=e.replace(/, $/,"");
""===e&&(e='<span class="none">none</span>');g+='<tr><td class="label">Markers:</td><td class="value">'+e+"</td></tr>";g+='<tr><td class="label">State:</td><td class="value"><code>'+c.state()+"</code></td></tr>";e="";for(d in c.__state_guards)a.isown(c.__state_guards,d)&&"number"===typeof c.__state_guards[d]&&0!==c.__state_guards[d]&&(e+="<code>"+d+"</code> ("+c.__state_guards[d]+"), ");e=e.replace(/, $/,"");""===e&&(e='<span class="none">none</span>');g+='<tr><td class="label">Guards:</td><td class="value">'+
e+"</td></tr>";d="";for(b in c.__spool)a.isown(c.__spool,b)&&"undefined"!==typeof c.__spool[b]&&0<c.__spool[b].length&&(d+="<code>"+b+"</code> ("+c.__spool[b].length+"), ");d=d.replace(/, $/,"");""===d&&(d='<span class="none">none</span>');g+='<tr><td class="label">Spools:</td><td class="value">'+d+"</td></tr>";d="";for(f in c.__config)if(a.isown(c.__config,f)&&f.match(/^ComponentJS:property:ComponentJS:model/)&&"object"===typeof c.__config[f])for(b in c.__config[f])a.isown(c.__config[f],b)&&(d+=
"<code>"+b+"</code>, ");d=d.replace(/, $/,"");""===d&&(d='<span class="none">none</span>');g+='<tr><td class="label">Model Values:</td><td class="value">'+d+"</td></tr>";b="";for(f in c.__config)a.isown(c.__config,f)&&f.match(/^ComponentJS:property:ComponentJS:socket:/)&&"object"===typeof c.__config[f]&&(b+="<code>"+f.replace(/^ComponentJS:property:ComponentJS:socket:/,"")+"</code>, ");b=b.replace(/, $/,"");""===b&&(b='<span class="none">none</span>');g+='<tr><td class="label">Sockets:</td><td class="value">'+
b+"</td></tr>";b="";for(f in c.__subscription)a.isown(c.__subscription,f)&&"object"===typeof c.__subscription[f]&&(c.__subscription[f].name.match(/^ComponentJS:/)||(b+="<code>"+c.__subscription[f].name+"</code>, "));b=b.replace(/, $/,"");""===b&&(b='<span class="none">none</span>');g+='<tr><td class="label">Event Subscriptions:</td><td class="value">'+b+"</td></tr>";b="";for(f in c.__subscription)a.isown(c.__subscription,f)&&"object"===typeof c.__subscription[f]&&c.__subscription[f].name.match(/^ComponentJS:service:/)&&
(b+="<code>"+c.__subscription[f].name.replace(/^ComponentJS:service:/,"")+"</code>, ");b=b.replace(/, $/,"");""===b&&(b='<span class="none">none</span>');g+='<tr><td class="label">Service Registrations:</td><td class="value">'+b+"</td></tr>";b="";for(f in c.__subscription)a.isown(c.__subscription,f)&&"object"===typeof c.__subscription[f]&&c.__subscription[f].name.match(/^ComponentJS:hook:/)&&(b+="<code>"+c.__subscription[f].name.replace(/^ComponentJS:hook:/,"")+"</code>, ");b=b.replace(/, $/,"");
""===b&&(b='<span class="none">none</span>');g+='<tr><td class="label">Hook Points:</td><td class="value">'+b+"</td></tr>";return g="<table>"+g+"</table>"};a.dbg=null;a.dbg_state_invalid={components:!1,states:!1,requests:!1,console:!1};a.dbg_state_invalidate=function(c){a.dbg_state_invalid[c]=!0};a.dbg_natural=!1;l.debug_instrumented=function(){return"undefined"!==typeof k&&k.console&&(k.console.firebug||120<k.outerHeight-k.innerHeight)};a.isIE=function(){return"undefined"!==typeof navigator&&"Microsoft Internet Explorer"===
navigator.appName&&navigator.userAgent.match(/MSIE ([0-9]+[.0-9]*)/)};l.debug_window=function(){var c=l.params("debugger",arguments,{enable:{pos:0,def:null},autoclose:{pos:1,def:!1},name:{pos:2,def:null},width:{def:800},height:{def:600},natural:{def:!1}});if(null===c.enable)return null!==a.dbg;if(c.enable){a.dbg_natural=c.natural;if(null===a.dbg){var b="ComponentJS Debugger";null!==typeof c.name&&(b+=" ("+c.name+")");var d=b,f;f="location=no,scrollbars=no,toolbars=no,menubar=no,status=no"+(",width="+
c.width+",height="+c.height);a.isIE()?d=d.replace(/ /g,"_").replace(/[()]/g,""):f+=",replace=yes";a.dbg=k.open("about:blank",d,f);a.isIE()&&(a.dbg.close(),a.dbg=k.open("about:blank",d,f));setTimeout(function(){a.jq(a.dbg.document).ready(function(){c.autoclose&&a.jq(k).bind("beforeunload",function(){null!==a.dbg&&a.dbg.close()});a.dbg_view_mask(b);a.dbg_refresh();a.jq(a.dbg).bind("resize",function(){a.dbg_refresh()});a.jq(".dbg",a.dbg.document).bind("selectstart",function(a){a.preventDefault();return!1});
var d=!1,e=!1,f=-1,l=-1;a.jq(".dbg .grabber",a.dbg.document).bind("mousedown",function(b){d=!0;a.jq(".dbg .grabber",a.dbg.document).css("background-color","red");b.preventDefault()});a.jq(".dbg",a.dbg.document).bind("mousemove",function(b){if(d){var c=b.pageY;300>c&&(c=300);var k=a.jq(a.dbg).height();c>k-100&&(c=k-100);a.jq(".dbg .grabber",a.dbg.document).css("top",c);a.dbg_grabber_offset=c;b.preventDefault()}else e&&(-1===f&&(f=b.pageX),-1===l&&(l=b.pageY),c=f-b.pageX,k=l-b.pageY,f=b.pageX,l=b.pageY,
a.dbg_canvas_info.x+=c,a.dbg_canvas_info.y+=k,a.dbg_reposition())});a.jq(".dbg",a.dbg.document).bind("mouseup",function(b){d&&(a.jq(".dbg .grabber",a.dbg.document).css("background-color","transparent"),a.dbg_refresh(),d=!1,b.preventDefault())});a.jq(".dbg .exporter",a.dbg.document).bind("click",function(b){var c=a.jq(".dbg .viewer canvas",a.dbg.document).get(0);"undefined"!==typeof c&&(c=c.toDataURL("image/png"),k.open(c));b.preventDefault();return!1});a.jq(".dbg .plus",a.dbg.document).bind("click",
function(){a.dbg_canvas_info.w+=100;a.dbg_canvas_info.h+=100;a.dbg_refresh()});a.jq(".dbg .minus",a.dbg.document).bind("click",function(){a.dbg_canvas_info.w-=100;a.dbg_canvas_info.h-=100;a.dbg_refresh()});a.jq(".dbg .reset",a.dbg.document).bind("click",function(){a.dbg_canvas_info.w=a.dbg_canvas_info.wmin;a.dbg_canvas_info.h=a.dbg_canvas_info.hmin;a.dbg_refresh()});a.jq(".dbg .viewer canvas",a.dbg.document).bind("mousedown",function(){e=!0;l=f=-1});a.jq(".dbg .viewer canvas",a.dbg.document).bind("mouseup",
function(){e=!1});a.jq(a.dbg.document).bind("keydown",function(b){43===b.keyCode||107===b.keyCode||187===b.keyCode?(a.dbg_canvas_info.w+=100,a.dbg_canvas_info.h+=100,a.dbg_refresh()):45===b.keyCode||109===b.keyCode||189===b.keyCode?(a.dbg_canvas_info.w-=100,a.dbg_canvas_info.h-=100,a.dbg_refresh()):48===b.keyCode?(a.dbg_canvas_info.w=a.dbg_canvas_info.wmin,a.dbg_canvas_info.h=a.dbg_canvas_info.hmin,a.dbg_refresh()):37===b.keyCode?(a.dbg_canvas_info.x+=10,a.dbg_reposition()):38===b.keyCode?(a.dbg_canvas_info.y+=
10,a.dbg_reposition()):39===b.keyCode?(a.dbg_canvas_info.x-=10,a.dbg_reposition()):40===b.keyCode&&(a.dbg_canvas_info.y-=10,a.dbg_reposition())})})},500)}l.debug(3,"debugger enabled")}else null!==a.dbg&&(l.debug(3,"debugger disabled"),a.dbg.close(),a.dbg=null)};a.dbg_grabber_offset=-1;a.dbg_canvas_info={x:0,y:0,w:-1,h:-1,wmin:-1,hmin:-1};a.dbg_refresh=function(){var c=a.jq(a.dbg).width(),b=a.jq(a.dbg).height();a.jq(".dbg",a.dbg.document).width(c).height(b);a.jq(".dbg .grabber",a.dbg.document).height(a.jq(".dbg .status",
a.dbg.document).height());if(-1===a.dbg_grabber_offset){var d=b-a.jq(".dbg .header",a.dbg.document).height();a.dbg_grabber_offset=Math.floor(d/2)+a.jq(".dbg .header",a.dbg.document).height()}d=a.dbg_grabber_offset-a.jq(".dbg .header",a.dbg.document).height();b=b-a.dbg_grabber_offset+a.jq(".dbg .status",a.dbg.document).height();a.jq(".dbg .viewer",a.dbg.document).height(d);a.jq(".dbg .console",a.dbg.document).height(b);a.jq(".dbg .infobox",a.dbg.document).height(b);a.jq(".dbg .infobox",a.dbg.document).css("top",
a.dbg_grabber_offset+a.jq(".dbg .status",a.dbg.document).height());a.jq(".dbg .grabber",a.dbg.document).css("top",a.dbg_grabber_offset);a.dbg_canvas_info.wmin=c;a.dbg_canvas_info.hmin=d;a.dbg_canvas_info.w<a.dbg_canvas_info.wmin&&(a.dbg_canvas_info.w=a.dbg_canvas_info.wmin);a.dbg_canvas_info.h<a.dbg_canvas_info.hmin&&(a.dbg_canvas_info.h=a.dbg_canvas_info.hmin);a.jq(".dbg .viewer canvas",a.dbg.document).height(a.dbg_canvas_info.h).attr("height",a.dbg_canvas_info.h).width(a.dbg_canvas_info.w).attr("width",
a.dbg_canvas_info.w);a.dbg_reposition();a.dbg_update()};a.dbg_reposition=function(){0>a.dbg_canvas_info.x&&(a.dbg_canvas_info.x=0);a.dbg_canvas_info.x>a.dbg_canvas_info.w-a.dbg_canvas_info.wmin&&(a.dbg_canvas_info.x=a.dbg_canvas_info.w-a.dbg_canvas_info.wmin);0>a.dbg_canvas_info.y&&(a.dbg_canvas_info.y=0);a.dbg_canvas_info.y>a.dbg_canvas_info.h-a.dbg_canvas_info.hmin&&(a.dbg_canvas_info.y=a.dbg_canvas_info.h-a.dbg_canvas_info.hmin);a.jq(".dbg .viewer canvas",a.dbg.document).css("top",-a.dbg_canvas_info.y).css("left",
-a.dbg_canvas_info.x)};a.dbg_timer=null;a.dbg_update=function(){null!==a.dbg&&null===a.dbg_timer&&(a.dbg_timer=setTimeout(function(){a.dbg_update_once();a.dbg_timer=null},250))};a.dbg_update_once=function(){a.dbg_state_invalid.console&&(a.jq(".dbg .console .text",a.dbg.document).html(a.dbg_logbook),a.jq(".dbg .console",a.dbg.document).scrollTop(a.jq(".dbg .console .text",a.dbg.document).height()),a.dbg_state_invalid.console=!0);if(a.dbg_state_invalid.components||a.dbg_state_invalid.requests||a.dbg_state_invalid.states){var c,
b,d;if(a.dbg_state_invalid.components||a.dbg_state_invalid.states)c=a.root.walk_down(function(b,c,d,e){if(e){e=b=0;for(var f=c.children(),g=0;g<f.length;g++)b+=a.annotation(f[g],"debugger_width"),e+=a.annotation(f[g],"debugger_total");0===e&&b++;e++;a.annotation(c,"debugger_width",b);a.annotation(c,"debugger_total",e)}else a.annotation(c,"debugger_depth",b),d=b>d?b:d;return d},1),b=a.annotation(a.root,"debugger_width"),d=a.annotation(a.root,"debugger_total");if(a.dbg_state_invalid.components||a.dbg_state_invalid.requests){var f=
0,g;for(g in a.state_requests)a.isown(a.state_requests,g)&&f++;a.jq(".dbg .status .text",a.dbg.document).html("Created Components: <b>"+d+"</b>, Pending Transition Requests: <b>"+f+"</b>");a.dbg_state_invalid.requests=!0}if(a.dbg_state_invalid.components||a.dbg_state_invalid.states){var e=a.jq(".dbg .viewer canvas",a.dbg.document).get(0);if("undefined"===typeof e)return;var e=e.getContext("2d"),k=a.jq(".dbg .viewer canvas",a.dbg.document).height()-20;d=a.jq(".dbg .viewer canvas",a.dbg.document).width()-
20;var w=Math.floor(d/b),q=Math.floor(k/(c+1)),y=Math.floor(w/8),u=Math.floor(q/4);e.clearRect(0,0,d,k);var v=a.dbg_natural;a.root.walk_down(function(b,c,d,f){if(f){f=a.annotation(c,"debugger_depth");var g,m;if(1===a.annotation(c,"debugger_total"))b=10+w*d++,f=v?k-q*f-q+10:q*f-10,g=w-y,m=q-u;else{var h=c.children();b=a.annotation(h[0],"debugger_x");a.annotation(h[0],"debugger_y");g=b;1<h.length&&(g=a.annotation(h[h.length-1],"debugger_x"),a.annotation(h[h.length-1],"debugger_y"));b+=Math.ceil((g-
b)/2);f=v?k-q*f-q+10:q*f-10;g=w-y;m=q-u;for(var p=0;p<h.length;p++){var r=a.annotation(h[p],"debugger_x"),n=a.annotation(h[p],"debugger_y"),s=a.annotation(h[p],"debugger_w");e.strokeStyle="#888888";e.lineWidth=2;e.beginPath();e.moveTo(b+Math.ceil(g/2),f+(v?0:m));e.lineTo(b+Math.ceil(g/2),f+(v?-Math.ceil(u/2):m+Math.ceil(u/2)));e.lineTo(r+Math.ceil(s/2),f+(v?-Math.ceil(u/2):m+Math.ceil(u/2)));e.lineTo(r+Math.ceil(s/2),n+(v?m:0));e.stroke()}}h="";l.marked(c.obj(),"view")&&(h+="V");l.marked(c.obj(),
"model")&&(h+="M");l.marked(c.obj(),"controller")&&(h+="C");l.marked(c.obj(),"service")&&(h+="S");"V"===h?(n="#14426f",p="#ffffff",s="#2068b0",r="#adcef0"):"M"===h?(n="#6f5014",p="#ffffff",s="#9a6f1c",r="#e8c581"):"S"===h?(n="#e8e8e8",p="#000000",s="#ffffff",r="#666666"):(n="#444444",p="#ffffff",s="#777777",r="#cccccc");e.save();e.fillStyle=n;e.shadowColor="#888888";e.shadowBlur=6;e.shadowOffsetX=1;e.shadowOffsetY=1;e.fillRect(b,f,g,m);e.restore();e.fillStyle=s;e.fillRect(b,f+m/2,g,m/2);e.save();
e.fillStyle=a.states[c.__state].color;e.shadowColor="#000000";e.shadowBlur=2;e.shadowOffsetX=0;e.shadowOffsetY=0;e.beginPath();e.arc(b+g-m/4-1,f+3*(m/4),m/4-3,0,2*Math.PI,!0);e.closePath();e.fill();e.restore();var n=!1,t;for(t in c.__state_guards)if("number"===typeof c.__state_guards[t]&&0!==c.__state_guards[t]){n=!0;break}n&&(e.save(),e.fillStyle="#ff0000",e.shadowColor="#000000",e.shadowBlur=2,e.shadowOffsetX=0,e.shadowOffsetY=0,e.beginPath(),e.arc(b+g-2*(m/4)-1,f+3*(m/4),m/4-3,0,2*Math.PI,!0),
e.closePath(),e.fill(),e.restore());t=function(a,b,c,d,f){e.fillStyle=b;b=e.measureText(a);if(b.width>f)for(;""!==a;){b=e.measureText(a+"...");if(b.width<=f){a+="...";break}a=a.substr(0,a.length-1)}e.fillText(a,c,d,f)};n=0;""!==h&&(e.font="bold "+0.7*(m/2)+"px Helvetica, Arial, sans-serif",e.textBaseline="top",n=e.measureText(h),t(h,r,b+g-n.width-4,f+2,n.width),n=n.width);e.font=0.7*(m/2)+"px Helvetica, Arial, sans-serif";e.textBaseline="top";t(c.name(),p,b+4,f+2,g-n-8);t(c.state(),r,b+4,f+m/2+2,
g-m/2-8);a.annotation(c,"debugger_x",b);a.annotation(c,"debugger_y",f);a.annotation(c,"debugger_w",g);a.annotation(c,"debugger_h",m)}return d},0);var x=!1;a.jq(".dbg .viewer canvas",a.dbg.document).bind("mousedown",function(b){b.target===a.jq(".dbg .viewer canvas",a.dbg.document).get(0)&&(z(b),x=!0)});a.jq(".dbg .viewer canvas",a.dbg.document).bind("mousemove",function(b){b.target===a.jq(".dbg .viewer canvas",a.dbg.document).get(0)&&x&&z(b)});a.jq(".dbg .viewer canvas",a.dbg.document).bind("mouseup",
function(b){b.target===a.jq(".dbg .viewer canvas",a.dbg.document).get(0)&&(a.jq(".dbg .infobox",a.dbg.document).css("display","none"),x=!1)});var z=function(b){var c=b.offsetX,d=b.offsetY,e=null;a.root.walk_down(function(b,f,g,k){if(k){b=a.annotation(f,"debugger_x");g=a.annotation(f,"debugger_y");k=a.annotation(f,"debugger_w");var l=a.annotation(f,"debugger_h");b<=c&&(c<=b+k&&g<=d&&d<=g+l)&&(e=f)}},0);null!==e&&(b=a.dbg_infobox_content(e),a.jq(".dbg .infobox",a.dbg.document).html(b),a.jq(".dbg .infobox",
a.dbg.document).css("display","block"))}}a.dbg_state_invalid.components=!0;a.dbg_state_invalid.states=!0}};a.latch("ComponentJS:log",function(c){var b=!1;null!==a.dbg&&(a.dbg_log(c),b=!0);return b});a.latch("ComponentJS:state-change",function(){a.dbg_update()});a.latch("ComponentJS:state-invalidate",function(c){a.dbg_state_invalidate(c)})});
